

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Under the hood &mdash; dnsprovejs  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Libraries" href="libraries.html" />
    <link rel="prev" title="Quick start" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> dnsprovejs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Under the hood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constructing-a-proof">Constructing a proof</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="libraries.html">Libraries</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dnsprovejs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Under the hood</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/underthehood.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="under-the-hood">
<h1>Under the hood<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>DNSSEC (The Domain Name System Security Extensions) establishes a chain of trust from the root key which signed by ICANN (.) and down through each key. We start off knowing the hash of the root key of DNS (this is hard coded in the smart contract oracle).
Given the hashes of that key, we can pass in the actual key, we can verify that it matches the hash and we can add it to the set of the trusted records.</p>
<p>Given that key, we can now verify any record that is signed with that key, so in this case, it’s the hash of the root of the xyz top level domain.
Given that, we can recognize the key, and so on and so forth.</p>
<img alt="_images/diagram.png" src="_images/diagram.png" />
<p>So next, you can regonize the key for the ethlab.xyz.
Given that, we can recognize the hash for the key, and then key itself,and finally you can verify a signed text record that contains the Ethereum address.</p>
</div>
<div class="section" id="constructing-a-proof">
<h2>Constructing a proof<a class="headerlink" href="#constructing-a-proof" title="Permalink to this headline">¶</a></h2>
<p>To construct a proof to submit to Oracle smart contract, you first need to provide name, rrsig, and rrset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">name:</th><td class="field-body">name of the dns record</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">rrsig:</th><td class="field-body">Resource record digital signature</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">sig</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RRSIG&#39;</span><span class="p">,</span>
    <span class="nx">ttl</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="kr">class</span><span class="o">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
    <span class="nx">flush</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span>
    <span class="p">{</span> <span class="nx">typeCovered</span><span class="o">:</span> <span class="s1">&#39;DNSKEY&#39;</span><span class="p">,</span>
        <span class="nx">algorithm</span><span class="o">:</span> <span class="mi">253</span><span class="p">,</span>
        <span class="nx">labels</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">originalTTL</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
        <span class="nx">expiration</span><span class="o">:</span> <span class="mi">2528174800</span><span class="p">,</span>
        <span class="nx">inception</span><span class="o">:</span> <span class="mi">1526834834</span><span class="p">,</span>
        <span class="nx">keyTag</span><span class="o">:</span> <span class="mi">5647</span><span class="p">,</span>
        <span class="nx">signersName</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="nx">signature</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">([])</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">rrset:</th><td class="field-body">DNS resource record sets</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">rrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DNSKEY&#39;</span><span class="p">,</span>
            <span class="nx">ttl</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="kr">class</span><span class="o">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
            <span class="nx">flush</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">flags</span><span class="o">:</span> <span class="mi">257</span><span class="p">,</span> <span class="nx">algorithm</span><span class="o">:</span> <span class="mi">253</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s2">&quot;1111&quot;</span><span class="p">,</span> <span class="s2">&quot;HEX&quot;</span><span class="p">)}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DNSKEY&#39;</span><span class="p">,</span>
            <span class="nx">ttl</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="kr">class</span><span class="o">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
            <span class="nx">flush</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">flags</span><span class="o">:</span> <span class="mi">257</span><span class="p">,</span> <span class="nx">algorithm</span><span class="o">:</span> <span class="mi">253</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s2">&quot;1111&quot;</span><span class="p">,</span> <span class="s2">&quot;HEX&quot;</span><span class="p">)}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DNSKEY&#39;</span><span class="p">,</span>
            <span class="nx">ttl</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="kr">class</span><span class="o">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
            <span class="nx">flush</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">flags</span><span class="o">:</span> <span class="mi">257</span><span class="p">,</span> <span class="nx">algorithm</span><span class="o">:</span> <span class="mi">253</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s2">&quot;1112&quot;</span><span class="p">,</span> <span class="s2">&quot;HEX&quot;</span><span class="p">)}</span>
        <span class="p">}</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Once the data is constructed, Instantiate <cite>Result</cite> object with the data which builds the proofs. <cite>toSubmit</cite> will generate the input data.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>      <span class="kr">const</span> <span class="nx">Result</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@ensdomains/dnsprovejs/dist/dns/result&#39;</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Result</span><span class="p">([{</span><span class="nx">name</span><span class="p">,</span><span class="nx">sig</span><span class="p">,</span><span class="nx">rrs</span><span class="p">}])</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">proofs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toSubmit</span><span class="p">()</span>
      <span class="c1">// [ &#39;0x0030fd0000000e1096b0e2d05b01a692160f00000030000100000e100006010103fd1111000030000100000e100006010103fd1111000030000100000e100006010103fd1112&#39;,</span>
<span class="s1">&#39;0x&#39;</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="libraries.html" class="btn btn-neutral float-right" title="Libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Makoto Inoue

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>